---
title: ApiHug Spring Cache Extension
description: ApiHug SDK Spring Cache æ‰©å±•
---

import { TipInfo } from '@/components/Tip'


## Cache

åŒ…å« [spring-cache](https://docs.spring.io/spring-boot/reference/io/caching.html) ç®€å•å°è£…ï¼š

1. é’ˆå¯¹ Caffeine,Redis, Ehcache çš„å°è£…
2. é”™è¯¯å°è£…å’Œå¤„ç† `HopeCacheErrorHandler`
3. `RedissonClient` è‡ªåŠ¨é…ç½® `hope.redis.enable=true`
4.  `EnableCaffeineCaching` `EnableRedisCaching` `EnableEhcacheCaching` æ”¯æŒ

### é…ç½®

#### Cache é…ç½®

`hope.cache` é…ç½®è·¯å¾„ï¼Œ é…ç½®å¯¹è±¡ï¼š `HopeCacheProperties`

| é…ç½®                                     | å¤‡æ³¨                                                              |
|----------------------------------------|-----------------------------------------------------------------|
| `caffeine`                             | åŒ…å«caffeineé…ç½®                                                    |
| `caffeine.allowInFlightCacheCreation`  | æ˜¯å¦å…è®¸åˆ›å»ºéå®šä¹‰cache                                                  |
| `caffeine.timeToLive`                  | é»˜è®¤TTL                                                           |
| `caffeine.caches`                      | å¤šcacheé…ç½®mapï¼Œå‚è€ƒ`com.github.benmanes.caffeine.cache.CaffeineSpec` |
| `caffeine.caches[*].initialCapacity`   | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].maximumWeight`     | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].maximumSize`       | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].recordStats`       | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].keyStrength`       | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].valueStrength`     | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].expireAfterWrite`  | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].expireAfterAccess` | å‚è€ƒ `CaffeinSpec`                                                |
| `caffeine.caches[*].refreshAfterWrite` | å‚è€ƒ `CaffeinSpec`                                                |
| `redis`                                | Redis é…ç½®                                                        |
| `redis.allowInFlightCacheCreation`     | æ˜¯å¦å…è®¸åˆ›å»ºéå®šä¹‰cache                                                  |
| `redis.timeToLive`                     | é»˜è®¤TTL                                                           |
| `redis.caches`                         | å¤šcacheé…ç½®map                                                     |
| `redis.caches[*].timeToLive`           | å•ä¸ªcache TTL                                                     |
| `redis.caches[*].cacheNullValues`      | å•ä¸ªcache è¿è¡ŒNULLå€¼                                                 |
| `redis.caches[*].keyPrefix`            | å•ä¸ªcache keyPrefix                                               |
| `redis.caches[*].useKeyPrefix`         | å•ä¸ªcache useKeyPrefix                                            |
| `redis.caches[*].enableStatistics`     | å•ä¸ªcache æ‰“å¼€ç»Ÿè®¡                                                    |
| `redis.caches[*].enableTransactions`   | å•ä¸ªcache äº‹åŠ¡ç®¡ç†                                                    |
| `redis.caches[*].serializer`           | å•ä¸ªcache åºåˆ—åŒ–                                                     |
| `ehCache`                              | EhCacheé…ç½®                                                       |
| `ehCache.heap`                         | Heap å®ä½“æ•°é‡(ä¸ª)                                                    |
| `ehCache.offHeap`                      | OffHeap å¤§å°(å­˜å‚¨)                                                  |
| `ehCache.disk`                         | Diskå¤§å°(å­˜å‚¨)                                                      |
| `ehCache.duration`                     | é»˜è®¤TTL                                                           |
| `ehCache.caches`                       | å„ä¸ªEhCacheé…ç½®                                                     |
| `ehCache.caches[*].keyClz`             | key ç±»å‹                                                          |
| `ehCache.caches[*].valueClz`           | value ç±»å‹                                                        |
| `ehCache.caches[*].heap`               | Heap å®ä½“æ•°é‡(ä¸ª)                                                    |
| `ehCache.caches[*].offHeap`            | OffHeap å¤§å°(å­˜å‚¨)                                                  |
| `ehCache.caches[*].disk`               | Diskå¤§å°(å­˜å‚¨)                                                      |
| `ehCache.caches[*].duration`           | TTL                                                             |
| `errorPolicy`                          | é”™è¯¯å¤„ç†ç­–ç•¥                                                          |
| `errorPolicy.swallowGetException`      | å¿½ç•¥Geté”™è¯¯                                                         |
| `errorPolicy.swallowPutException`      | å¿½ç•¥Puté”™è¯¯                                                         |
| `errorPolicy.swallowEvictException`    | å¿½ç•¥Evicté”™è¯¯                                                       |
| `errorPolicy.swallowClearException`    | å¿½ç•¥Clearé”™è¯¯                                                       |
| `errorPolicy.logStackTraces`           | æ‰“å°é”™è¯¯å †æ ˆ                                                          |
| `timeToLive`                           | é»˜è®¤TTL(å…œåº•)                                                       |

#### Redis é…ç½®

é…ç½®è·¯å¾„ï¼š`hope.redis`ï¼› é…ç½®å¯¹è±¡ï¼š `HopeRedisProperties`

ä¼—å’Œäº†spring æœ¬èº«çš„é…ç½®ï¼š 

1. [org.springframework.boot.autoconfigure.cache.CacheProperties](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/cache/CacheProperties.java)
2. [org.springframework.boot.autoconfigure.data.redis.RedisProperties](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/RedisProperties.java)
3. [org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/cache/CacheAutoConfiguration.java)
4. [Spring boot cache](https://docs.spring.io/spring-boot/reference/io/caching.html)
5. [Spring Cache **spring.cache**](https://docs.spring.io/spring-boot/appendix/application-properties/index.html#appendix.application-properties.cache)
6. [Spring Data redis **spring.data.redis**](https://docs.spring.io/spring-boot/appendix/application-properties/index.html#appendix.application-properties.data)

Hope æ›´å€Ÿé‰´ **spring.data.redis** é…ç½®æ–¹å¼ï¼Œ ä¹Ÿå°±æ˜¯å’Œ [org.springframework.boot.autoconfigure.data.redis.RedisProperties](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/RedisProperties.java) æ¯”è¾ƒç±»ä¼¼ï¼›


| é…ç½®                       | å¤‡æ³¨                                                                                                                                          |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| `cluster`                | é›†ç¾¤èŠ‚ç‚¹é…ç½®                                                                                                                                      |
| `cluster.max-redirects.` | Maximum number of redirects to follow when executing commands across the cluster.                                                           |
| `cluster.nodes`          | List of "host:port" pairs to bootstrap from. This represents an "initial" list of cluster nodes and is required to have at least one entry. |
| `sentinel`               | sentinelèŠ‚ç‚¹                                                                                                                                  |
| `sentinel.master`        | sentinelèŠ‚ç‚¹                                                                                                                                  |
| `sentinel.nodes`         | List of "host:port" pairs.                                                                                                                  |
| `sentinel.username`      | Login username for authenticating with sentinel(s).                                                                                         |
| `sentinel.password`      | Password for authenticating with sentinel(s).                                                                                               |
| `master`                 | masterã€slavesé…ç½®æ–¹å¼                                                                                                                           |
| `master.master`          | master èŠ‚ç‚¹ host:port                                                                                                                         |
| `master.slaves`          | slave èŠ‚ç‚¹ host:port åˆ—è¡¨                                                                                                                       |
| `master.username`        | ç”¨æˆ·å                                                                                                                                         |
| `master.password`        | å¯†ç                                                                                                                                           |
| `database`               | Database index used by the connection factory.                                                                                              |
| `enable`                 | -                                                                                                                                           |
| `config`                 | é€šè¿‡è·¯å¾„å¼•å…¥ redission [é…ç½®æ–‡ä»¶](https://redisson.org/docs/configuration/)                                                                           |
| `url`                    | Connection URL. Overrides host, port, username, and password. Example: redis://user:password@example.com:6379                               |
| `host`                   | Redis server host.                                                                                                                          |
| `username`               | Login username of the redis server.                                                                                                         |
| `password`               | Login password of the redis server.                                                                                                         |
| `port`                   | Redis server port.                                                                                                                          |
| `ssl`                    | Whether to enable SSL support.                                                                                                              |
| `poolSize`               | è¿æ¥æ± å¤§å°                                                                                                                                       |
| `idleSize`               | æœ€å°ç©ºé—²è¿æ¥æ•°                                                                                                                                     |
| `idleTimeout`            | è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’                                                                                                                                |
| `connectionTimeout`      | è¿æ¥è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’                                                                                                                                  |
| `timeout`                | å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’                                                                                                                                |
| `clientName`             | Client name to be set on connections with `CLIENT SETNAME`.                                                                                 |

### é”™è¯¯å¤„ç†

æ ¹æ® `errorPolicy` é…ç½®è¿›è¡Œå¤„ç†ï¼Œ å¦‚éœ€æŠ›å‡ºç»„è£…æˆ `CacheErrorsEnum` è¾“å‡ºï¼š

| é”™è¯¯ç         | é”™è¯¯æ ‡é¢˜                        | é”™è¯¯æè¿°                           | é”™è¯¯æè¿°2  |
|------------|-----------------------------|--------------------------------|--------|
| 1002000001 | FAIL_GET_CACHE              | fail get data from the cache   | ç¼“å­˜æ²¡æœ‰å‘½ä¸­ |
| 1002000002 | FAIL_EVICT_CACHE            | fail evict data from the cache | æ¸…é™¤ç¼“å­˜å¤±è´¥ |
| 1002000003 | FAIL_PUT_CACHE              | fail put data to the cache     | æ›´æ–°ç¼“å­˜å¤±è´¥ |
| 1002000004 | FAIL_CLEAR_CACHE            | fail clear cache               | æ¸…ç†ç¼“å­˜å¤±è´¥ |
| 1002000005 | FAIL_CREATE_CACHE           | fail create cache              | åˆ›å»ºç¼“å­˜é”™è¯¯ |
| 1002000006 | CACHE_CONFIGURATION_ILLEGAL | cache configuration illegal    | ç¼“å­˜é…ç½®é”™è¯¯ |


### ~hope.cache.type~

è€çš„æ§åˆ¶æ–¹å¼ï¼Œæ ¹æ® ~hope.cache.type~ ç±»å‹è§¦å‘é…ç½®ä¸Šä¸‹æ–‡ï¼Œç°å·²ä¸æ”¯æŒï¼ 

1. CAFFEINE  é€šè¿‡æ˜¾å¼çš„  `EnableCaffeineCaching`
2. REDIS  é€šè¿‡æ˜¾å¼çš„  `EnableRedisCaching`
3. JCACHE  é€šè¿‡æ˜¾å¼çš„  `EnableEhcacheCaching`


<TipInfo>To be done ğŸ—ï¸</TipInfo>
