---
title: DSL domain specific language of Kola
description: Kola background, Kola a consumer driver tester framework
---

## Concept

Âú® Kola ÂÆö‰Ωç‰∏≠ [Kola ÊòØ‰ªÄ‰πà](/zhCN-docs/kola/001_what_is_kola), ÊòØËá¥Âäõ‰∫éÊèê‰æõ‰∏Ä‰∏™ËÆ©Áõ∏ÂÖ≥ÂêÑÊñπÈÉΩËÉΩÂ§üÁêÜËß£ÂÖ±ÂêåÂàõÈÄ†ÁöÑÊµãËØïÊ°ÜÊû∂ÂíåÂ∑•ÂÖ∑„ÄÇ

ÂêåÊó∂ Kola ÊòØÂª∫Á´ã‰∫é‰∏öÁïåÊàêÁÜüÁöÑÂÆûË∑µÂíåÊñπÊ≥ïËÆ∫‰∏äÔºåÁªºÂêàÂ∑•Á®ãÂÆûË∑µÁöÑ‰æøÂà©ÂíåÊµÅÁ®ãÁöÑ‰∏•Ë∞®ÊÄßÔºå Âú®‰∏ªÊµÅÁöÑÊµãËØïÊÄùÊÉ≥‰∏≠ÔºåËøô‰∏âÁßç Kola Ê∑±ÂèóÂêØÂèëÔºö

1. TDD: Test driven development
2. BDD: Behaviour-Driven Development
3. CDC: Consumer Driven Contracts

Âú®Â∑•Á®ãÂÆûË∑µ‰∏≠; Kola ‰ªé SmartBear ÁöÑ PactFlow, Spring clout Contract, Spock, Karate Á≠âÂâçËæà‰∏äÂæóÂà∞ÂæàÂ§öÂèÇËÄÉÂíåÁÅµÊÑüÔºõ

Êõ¥‰∏çÁî®ËØ¥Ôºå ÊµãËØïÁïåÁöÑÂü∫Áü≥: Junit5, TestNG, AssertJ Á≠âÂü∫Á°ÄÊ°ÜÊû∂Ôºõ

Kola ‰∏ÄÂ¶ÇÊó¢ÂæÄÈÅµÂæ™ËΩØ‰ª∂ÂºÄÂèëÁöÑÂºÄÈó≠ÂéüÂàôÔºå Âú®Â≠¶‰π†ÊàêÊú¨„ÄÅÂ∑•Á®ãÂÆûË∑µ„ÄÅÂõ¢ÈòüÂçèÂêå‰∏äÂÅöÁªºÂêàÁöÑË∞ÉÂíåÔºå ËÆ©Êï¥‰∏™ÊµãËØïËøáÁ®ãÊõ¥‰∏ùÊªëÔºåÊõ¥‰∫∫ÊÄßÂåñ:

> Kola make your test life happier and colourful

‰∏∫‰ªÄ‰πà **BDD** È£éÊ†ºÂ£∞Êòé‰∏∫È¶ñÈÄâÔºü ËôΩÁÑ∂Êàë‰ª¨Ê≤°Êúâ‰ΩøÁî®‰∏ªÊµÅ BDD ÂÆûË∑µÊ°ÜÊû∂ÊØîÂ¶Ç Cucumber, ‰Ωú‰∏∫Â∫ïÂ∫ßÔºõ

‰ΩÜÊòØ BDD ÁöÑË°®ËææÊñπÂºèÔºåÁúüÁöÑÊòØÂ§™Â•Ω‰∫ÜÔºåÂÖºÈ°æÁ®ãÂ∫è‰∏ñÁïåÁöÑÁªìÊûÑÂåñÔºåÂíåÈùûÁ®ãÂ∫è‰∏ñÁïåÁöÑÈÄö‰øóÊòìÊáÇÔºõÊâÄ‰ª•Áî®‰ªñÊù•Ë°®ËææÁî®Êà∑Áî®‰æã(ÊïÖ‰∫ã)ÂÜçÂ•Ω‰∏çËøáÔºÅ

```shell
Feature: Explaining ApiHug
  In order to gain an understanding of the ApiHug testing system
  As a non-programmer
  I want to have an overview of ApiHug that is understandable by non-geeks

  Scenario: A worker seeks an overview of ApiHug 
    Given I have a coworker who knows a lot about ApiHug
    When I ask my coworker to give an overview of how ApiHug works
    And I listen to their explanation
    Then I should have a basic understanding of ApiHug
```

Ëøô‰∏™Êù•Ëá™ÂÆòÊñπÁöÑÊ†áÂáÜBDD ÂÆö‰πâÊñπÂºèÔºå Âú® Kola Âü∫Êú¨Âùá‰øùÁïôÔºå Èô§ `And` Ë¢´ÁúÅÊéâÔºõ

Âõ†‰∏∫‰∏ÄËà¨Êàë‰ª¨ÊòØ request, response ÊñπÂºèÈ™åËØÅAPI, `And` Â∞±ÊòØÂèëÈÄÅËØ∑Ê±ÇÔºå `Then` Áõ¥Êé•ÂØπÁªìÊûúÈ™åËØÅ„ÄÇ

Kola, ÂçèËÆÆÂÆö‰πâÂú®: `import hope.kola.contract.Feature` ‰ΩøÁî® groovy ËØ≠Ê≥ïÔºå ËÆ©Êï¥‰ΩìÁöÑÁî®‰æã‰π¶ÂÜôÊõ¥ËΩªÊùæÂíåÊÑâÊÇ¶„ÄÇ

üëç Â¶ÇÊûú‰Ω†ÁöÑ Feature Groovy Âú®IDEÊú™ËÉΩËØÜÂà´Ôºå Âú®Êõ¥Êñ∞ÁâàÊú¨ÂêéÂ∞ùËØï Reload gradle ‰ª•ËÆ©IDEÂà∑Êñ∞ËØÜÂà´„ÄÇ

## Background

> A Background allows you to add some context to the scenarios that follow it. It can contain one or more Given steps, which are run before each scenario, but after any Before hooks.

## Feature

> The purpose of the Feature keyword is to provide a high-level description of a software feature, and to group related scenarios.

## Scenario

> a written description of your product‚Äôs behavior from one or more users‚Äô perspectives

### Given

> Given steps are used to describe the initial context of the system - the scene of the scenario. It is typically something that happened in the past.

Âú® ApiHug ‰∏ä‰∏ãÊñáÔºå `Given` Â∞±ÊòØ API ÁéØÂ¢ÉÔºå ÂèØ‰ª•‰ªé ApiHug ÊàñËÄÖÁã¨Á´ãÁöÑAPI ÁéØÂ¢ÉÂºïÂÖ•Ôºö

#### ApiHug API

Ëøô‰∏™ÊòØÊúÄÁõ¥Êé•ÁöÑÊñπÂºèÔºö

```groovy
    Given {
        api("UserService", "Login")
    }
```

1. `UserService` ApiHug ÊúçÂä°, ÊúÄÂ•ΩÂÖ®Ë∑ØÂæÑÂºïÂÖ•Ôºå ÁºñËØëÊó∂‰ºöÊ†°È™åÔºå Áõ∏ÂØπË∑ØÂæÑ‰πüÂèØ‰ª•Ôºå ‰ΩÜÊòØ‰øùËØÅÊó†ÈáçÂ§çÔºå IDEA Êèê‰æõÂ∑•ÂÖ∑Ëá™Âä®ÂåñÂÆåÊàê
2. `Login` ÊñπÊ≥ïÂêçÔºå Âú®Ê≠§ÊúçÂä°ÂÜÖÂøÖÈ°ªÂåÖÂê´

Áõ¥Êé•Áî® ApiHug ‰∏ä‰∏ãÊñáÁöÑ api ÂèØ‰ª•ÊúâÊõ¥‰∏∞ÂØåÁöÑ‰∏ä‰∏ãÊñáÔºå ÂÖ≥‰∫érequest, response ÁöÑÂÆö‰πâÔºå path, ÂèÇÊï∞Ôºå Ê†°È™åËßÑÂàô„ÄÇ

request body È¢Ñ mock, Êó†È°ªËá™Â∑±ÂÜô body, Âè™ÈúÄÁ®çÂæÆË∞ÉÊï¥Â∞±ÂèØ‰ª•„ÄÇ

ÊòØ kola È¶ñÊé®ÁöÑÊñπÂºèÔºÅ

#### Raw API

Â¶ÇÊûúÁ¨¨‰∏âÊñπÁöÑAPIÔºå Êàë‰ª¨Ê≤°ÊúâÁöÑÂÖÉ‰ø°ÊÅØÔºåÂè™ËÉΩÈÄöËøáÊâãÂä®ÂÜôÔºö

```groovy
    Given {
        get("https://github.com")
    }
```

### When

> When steps are used to describe an event, or an action. This can be a person interacting with the system, or it can be an event triggered by another system.

Âú® ApiHug ÁöÑÂÆö‰πâ‰∏≠Ôºå When Áî®Êù•ÁªÑË£Ö request ÁöÑ‰∏ä‰∏ãÊñáÔºö

| ÊñπÊ≥ï          | Â§áÊ≥®                          |
|-------------|-----------------------------|
| `json`      | ÂéüÂßãjson                      |
| `body`      | ËØ∑Ê±Ç‰ΩìÔºåÂèØ‰ª•ÈÄöËøájson, ÁÑ∂ÂêéÈÄöËøáÁîüÂëΩÂºèËØ≠Ê≥ïÂä®ÊÄÅÂ£∞Êòé |
| `multipart` | ÈôÑ‰ª∂                          |
| `cookies`   | cookie ‰ø°ÊÅØ                   |
| `headers`   | header ‰ø°ÊÅØ                   |
| `queries`   | ËØ∑Ê±ÇÂèÇÊï∞(Âä®ÊÄÅ)                    |
| `paths`     | Ë∑ØÂæÑÂèÇÊï∞(Âä®ÊÄÅ)                    |

#### ËØ∑Ê±Ç‰Ωì

**JSON** ÂÆö‰πâ:

```groovy
json("""
{
   "name": "jake",
   "age": 18,
   "address": {
     "country": "$V('from')",
     "zip": 200021
   }
}
""")
```

1. Ê†áÂáÜ json ÂÆö‰πâÊñπÂºè
2. Âä®ÊÄÅÁéØÂ¢ÉÂèòÈáè `$V('from')` ËøêË°åÊó∂‰ºöÈÄöËøá expression ‰ªéÁéØÂ¢É‰∏≠Ëé∑Âèñ  `from` ÂèÇÊï∞ÂÄºÔºõ

**body** ‰øÆÊîπ:

ÂÆö‰πâÂÆåÊàêÂêéÂ¶ÇÊûúËøò‰∏çËÉΩÊª°Ë∂≥ÈúÄÊ±ÇÔºåÂèØ‰ª•ÁªßÁª≠ÈÄöËøá body ËøõË°å json path Ëøõ‰∏ÄÊ≠•‰øÆÊîπ, ‰øÆÊîπÂíåË¶ÜÁõñÂéüÊù•ÂÄº;

```groovy
  body {
      set('name', "same")
      set('student.name', "blue")
      set('student.age', 22)
      set('student.weight', 123.3d)
      set('student.friends', "jake", "blue", "yellow")
      fromGlobal("student.country", "country")
  }
```

ÊúÄÁªàÁªÑË£ÖÊàê‰∏Ä‰∏™ÂêàÈÄÇÁöÑËØ∑Ê±Ç‰ΩìÔºõ

#### multipart

```groovy
  multipart {
      file{
        fromClassPath("hello.txt")
      }
  }
```

#### cookies

```groovy
    cookies {
        //Possible Bear + {jwt}
        fromGlobal(authorization(), "jwt")
    }
```

#### headers

#### queries

```groovy
  queries {
      pageable {
          page(0)
          size(12)
      }
      fromGlobal("userName", "jake")
  }
```

#### paths

```groovy
  paths {
      fromGlobal("user-id", "userId")
  }
```


### Then

> Then steps are used to describe an expected outcome, or result.

#### **status**

```groovy
  Then {
      isOk()
      status 200
  }
```

#### **body**

```groovy
    stringAssert("user.address.zipCode", {
        isEqualTo("jake")
        isBase64()
        isAlphabetic()
        startsWithIgnoringCase("json")
    })
    bigDecimalAssert("user.salary", {
        isCloseTo(new BigDecimal("1112.22"), Offset.offset(12))
        isGreaterThanOrEqualTo(new BigDecimal("231312"))
    })
    booleanAssert("user.live", {
        isTrue()
    })
```

1. Âü∫‰∫é json path
2. Assertj Assertions ÂÖ®ÈÉ® bridge, Fluent assertions
3. Â£∞ÊòéÂºèÊ†°È™åÔºå‰∏ÄÂÜôÂà∞Â∫ïÔºå‰∏ÄÊ∞îÂëµÊàê

## Script Support

### Pre Script

### Post Script

```groovy
    postScript {
        {
            headSet("age", 1234)
            globalSet("same", "blue")
        }
    }
```

## Junit

Consumer Driven Contracts, What's Kola's domain language looks like?

How it easy to understand and get hand in.  you will love it.

Default Extension, lifecycle management.


## Configuration

Use DSL to define environment also `{WIRE_MODULE}/src/test/resources/config/kola.groovy`:

1. common: base configuration
2. different env overwrite configuration property
3. active env base on the passed env flag: `-Dtags=qa,dev`

```groovy
import com.test.bigger.example.Student
import static hope.kola.contract.Configuration.*

var big = 1123

[
        common {
            baseURI("https://qa.example.com")
            port(9527)
            p("date", ofDate("2022-12-12"))
            rest {
                log {
                    enablePrettyPrinting()
                    logBodyDetailIfValidationFails()
                }
            }

        },

        env("qa", {

            baseURI("https://qa.example.com")
            port(big)

        }),

        env("prod", {

            baseURI("https://prod.example.com")
            p("date", nowDayOfMonth())
            p("bigStudent", new Student().setName("jake").setAge(19))
            rest {
                closeIdleConnectionsAfterEachResponse(12l, second())
                log {
                    logAllDetailIfValidationFails()
                }
            }
        })
]
```


## Full Feature Sample

```groovy
import hope.kola.contract.Feature
import org.assertj.core.data.Offset

Feature.make {
    priority 100
    name("Customer login place order and check balance logic")
    description("""Never judge the boss, as you may the real fool""")
    Scenario "001 Try login ", {
        preScript {
            //Define prepare logic here
        }
        Given {
            api("UserService", "Login")
        }
        When {
            json("""
                    
            """)
            body {
                set('name', "same")
                set('student.name', "blue")
                set('student.age', 22)
                set('student.weight', 123.3d)
                set('student.friends', "jake", "blue", "yellow")
                fromGlobal("student.country", "country")
            }
            queries {
                pageable {
                    page(0)
                    size(12)
                }
                fromGlobal("userName", "jake")
            }
            paths {
                fromGlobal("user-id", "userId")
            }
        }
        And {
            stringAssert("user.address.zipCode", {
                isEqualTo("jake")
                isBase64()
                isAlphabetic()
                startsWithIgnoringCase("json")
            })
            bigDecimalAssert("user.salary", {
                isCloseTo(new BigDecimal("1112.22"), Offset.offset(12))
                isGreaterThanOrEqualTo(new BigDecimal("231312"))
            })
            booleanAssert("user.live", {
                isTrue()
            })

        }
        postScript {
            {
                headSet("age", 1234)
                globalSet("same", "blue")
            }
        }

    }
    Scenario "002 Place a order", {}
    Scenario "003 Check balance", {}
}
```


## ÂèÇËÄÉ

1. spring test [spring-framework/spring-test](https://github.com/spring-projects/spring-framework/tree/main/spring-test)
2. spring test doc [spring-framework/reference/testing](https://docs.spring.io/spring-framework/reference/testing.html)
3. spring boot test [spring-boot-test](https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-test)
4. spring boot test doc [spring-boot/testing](https://docs.spring.io/spring-boot/reference/testing/index.html)
5. spring contract [spring-cloud-contract](https://github.com/spring-cloud/spring-cloud-contract)
6. spring contract doc [spring-cloud-contract reference](https://docs.spring.io/spring-cloud-contract/reference/)
7. cucumber [Behaviour-Driven Development](https://cucumber.io/docs/bdd/)
8. Spock: [Spock Framework](https://spockframework.org/)
9. [karate](https://karatelabs.github.io/karate/) Test Automation Made Simple
10. [Contract Test](https://martinfowler.com/bliki/ContractTest.html) Martin Fowler
11. [PactFlow](https://pactflow.io/) SmartBear Consumer Driven
12. [Contract Testing Vs Integration Testing](https://pactflow.io/blog/contract-testing-vs-integration-testing/) from PactFlow
13. [Consumer-Driven Contracts: A Service Evolution Pattern](https://martinfowler.com/articles/consumerDrivenContracts.html)
